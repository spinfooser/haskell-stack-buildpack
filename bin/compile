#!/bin/bash

set -eo pipefail

BUILDDIR=$1
CACHEDIR=$2
BINDIR=$CACHEDIR/bin
export PATH=$PATH:$BINDIR

mkdir -p $HOME/.cabal
mkdir -p $BINDIR

pushd $CACHEDIR

echo "Downloading Stack Tool"
wget -qO- -O stack.tar.gz https://www.stackage.org/stack/linux-x86_64
tar xf stack.tar.gz
mv stack*linux-x86_64/stack $BINDIR

#apt-get install libgmp-dev
echo "Stack setup completed"

echo "Build Haskell compiler started"
stack setup --stack-setup-yaml $BINDIR/stack.yml
echo "Build Haskell compiler completed"

pushd $BINDIR
echo "App build started"
stack build
echo "App build completed"
popd
